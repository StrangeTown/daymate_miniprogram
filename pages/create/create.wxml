<!--pages/create/create.wxml-->
<navigation-bar title="创建" back="{{true}}" color="black" background="#FFF"></navigation-bar>

<view class="create-container">
  <view class="form-section">
    <!-- Title Section -->
    <view class="section-part">
      <picker
        mode="date"
        value="{{eventDate}}"
        start="{{minDate}}"
        bindchange="onDateChange"
      >
        <view class="date-picker">
          <text class="date-text">{{eventDate || '请选择日期'}}</text>
          <text class="picker-icon">📅</text>
        </view>
      </picker>

      <input
        class="input-field"
        type="text"
        placeholder="请输入事件名称"
        value="{{eventTitle}}"
        bindinput="onTitleInput"
      />
    </view>

    <!-- Marker Section -->
    <view class="section-part">
      <view class="section-header">
        <text class="section-title">日历标记</text>
      </view>

      <!-- Images Part -->
      <view class="marker-subsection">
        <scroll-view class="images-scroll" scroll-y="true" enable-flex="true">
          <view class="images-list">
            <view
              wx:for="{{availableImages}}"
              wx:key="index"
              class="image-item {{selectedImage === item.name ? 'selected' : ''}} {{selectedGif || selectedLetter ? 'disabled' : ''}}"
              bindtap="onImageSelect"
              data-image="{{item.name}}"
            >
              <image class="event-image-preview" src="{{item.url}}" mode="aspectFit"></image>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- Separator -->
      <view class="marker-separator"></view>

      <!-- GIF Part -->
      <view class="marker-subsection">
        <view class="gif-container {{!isGifLocked ? 'unlocked' : ''}}">
          <scroll-view class="images-scroll gif-images-scroll" scroll-y="true" enable-flex="true">
            <view class="images-list">
              <view
                wx:for="{{availableGifs}}"
                wx:key="item.name"
                class="image-item {{selectedGif === item.url ? 'selected' : ''}} {{selectedImage || selectedLetter ? 'disabled' : ''}}"
                bindtap="onGifSelect"
                data-gif="{{item.name}}"
              >
                <image class="event-image-preview" src="{{item.url}}" mode="aspectFit"></image>
              </view>
            </view>
          </scroll-view>

          <!-- GIF Lock Overlay -->
          <view wx:if="{{isGifLocked}}" class="gif-overlay">
            <view class="lock-container" bindtap="onLockContainerTap">
              <text class="lock-icon">🔒</text>
              <view class="lock-tip">看一段广告，立即解锁动画图标！</view>
            </view>
          </view>
        </view>
      </view>


      <!-- Separator -->
      <view wx:if="{{letters.length > 0}}" class="marker-separator"></view>

      <!-- Letters Part -->
      <view wx:if="{{letters.length > 0}}" class="marker-subsection">
        <view class="letters-list">
          <view
            wx:for="{{letters}}"
            wx:key="index"
            class="letter-item {{selectedLetter === item ? 'selected' : ''}} {{selectedImage || selectedGif ? 'disabled' : ''}}"
            bindtap="onLetterSelect"
            data-letter="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>

    </view>

    <!-- Subscribe Section -->
    <view class="section-part">
      <view class="section-header subscribe-header">
        <text class="section-title">前一天通知</text>
        <switch
          class="subscribe-switch"
          checked="{{enableNotification}}"
          bindchange="onNotificationToggle"
          color="#E96354"
        />
      </view>
    </view>
  </view>

  <view class="button-section">
    <button class="save-button" bindtap="onSaveEvent">保存</button>
  </view>
</view>

<!-- Custom Success Modal -->
<view wx:if="{{showSuccessModal}}" class="custom-modal-overlay" bindtap="hideSuccessModal">
  <view class="custom-modal" bindtap="">
    <view class="modal-header">
      <text class="modal-title">解锁成功</text>
    </view>
    <view class="modal-content">
      <view class="modal-message-container">
        <text class="modal-message">动画图标已解锁，</text>
        <text class="modal-message">可在未来 24 小时内无限使用</text>
      </view>
    </view>
    <view class="modal-footer">
      <button class="modal-confirm-btn" bindtap="hideSuccessModal">好的</button>
    </view>
  </view>
</view>